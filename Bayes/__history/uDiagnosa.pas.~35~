unit uDiagnosa;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, DBGridEhGrouping,
  ToolCtrlsEh, DBGridEhToolCtrls, DynVarsEh, EhLibVCL, GridsEh, DBAxisGridsEh,
  DBGridEh;

type
  TfoDiagnosa = class(TForm)
    Button1: TButton;
    GroupBox1: TGroupBox;
    CheckBox1: TCheckBox;
    CheckBox2: TCheckBox;
    CheckBox3: TCheckBox;
    CheckBox4: TCheckBox;
    CheckBox5: TCheckBox;
    CheckBox6: TCheckBox;
    CheckBox7: TCheckBox;
    DBGridEh1: TDBGridEh;
    GroupBox2: TGroupBox;
    Label1: TLabel;
    procedure Button1Click(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
  private
    { Private declarations }
  public
    { Public declarations }
    procedure gridbersih;
    PROCEDURE CEKBOX1;
    PROCEDURE CEKBOX2;
    PROCEDURE CEKBOX3;
    procedure cekbox4;
    procedure cekbox5;
    procedure cekbox6;
    procedure cekbox7;
    procedure kali;
  end;

var
  foDiagnosa: TfoDiagnosa;

implementation

{$R *.dfm}

uses uDM;

procedure TfoDiagnosa.Button1Click(Sender: TObject);
begin
  gridbersih;
  CEKBOX1;
  CEKBOX2;
  CEKBOX3;
  cekbox4;
  cekbox5;
  cekbox6;
  kali;

  with dm.quKali do
  begin
    Close;
    sql.Clear;
    sql.Text := 'UPDATE tbkali set '+
      'perkalian= '+
      'case '+
        'when kdPenyakit="A" then (SELECT (EXP(SUM(LOG(bobotRule))) * 0.5) FROM tbhitung where kdPenyakit="A") '+
        'when kdPenyakit="B" then (SELECT (EXP(SUM(LOG(bobotRule))) * 0.6) FROM tbhitung where kdPenyakit="B") '+
        'when kdPenyakit="D" then (SELECT (EXP(SUM(LOG(bobotRule))) * 0.6) FROM tbhitung where kdPenyakit="D") '+
        'when kdPenyakit="F" then (SELECT (EXP(SUM(LOG(bobotRule))) * 0.7) FROM tbhitung where kdPenyakit="F") '+
      'end; '+
      'set @jumlah := (SELECT SUM(perkalian) from tbkali); '+
      'update tbkali set hasil = '+
      'case '+
        'when kdPenyakit="A" THEN perkalian/@jumlah '+
        'when kdPenyakit="B" THEN perkalian/@jumlah '+
        'when kdPenyakit="D" THEN perkalian/@jumlah '+
        'when kdPenyakit="F" THEN perkalian/@jumlah '+
      'end;';
    ExecSQL;
  end;
  dm.quKali.SQL.Text := 'select * from tbkali';
  dm.quKali.Open;
  dm.quKali.ExecSQL;

  with dm.quKali do
  begin
    Close;
    SQL.Clear;
    sql.Text:='select * from tbkali ORDER BY hasil desc';
    ExecSQL;
  end;

  with dm.quPenyakit do
  begin
    close;
    sql.Clear;
    sql.Text:='select tbpenyakit.nmPenyakit, tbkali.hasil '+
              'from tbpenyakit JOIN tbkali '+
              'WHERE tbkali.kdPenyakit=tbpenyakit.kdPenyakit '+
              'ORDER BY tbkali.hasil desc; '+
  end;

end;

procedure TfoDiagnosa.CEKBOX1;
begin
  if CheckBox1.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='1';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='1';
      ParamByName('bobotRule').AsString:='0.7';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='1';
      ParamByName('bobotRule').AsString:='0.7';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='1';
      ParamByName('bobotRule').AsString:='0.6';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.CEKBOX2;
begin
  if CheckBox2.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='2';
      ParamByName('bobotRule').AsString:='0.9';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='2';
      ParamByName('bobotRule').AsString:='0.1';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='2';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='2';
      ParamByName('bobotRule').AsString:='0.5';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.CEKBOX3;
begin
  if CheckBox3.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='3';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='3';
      ParamByName('bobotRule').AsString:='0.7';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='3';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='3';
      ParamByName('bobotRule').AsString:='0.75';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.cekbox4;
begin
  if CheckBox4.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='4';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='4';
      ParamByName('bobotRule').AsString:='0.9';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='4';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='4';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.cekbox5;
begin
  if CheckBox5.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='5';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='5';
      ParamByName('bobotRule').AsString:='0.3';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='5';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='5';
      ParamByName('bobotRule').AsString:='0.9';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.cekbox6;
begin
  if CheckBox6.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='6';
      ParamByName('bobotRule').AsString:='0.95';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='6';
      ParamByName('bobotRule').AsString:='0.3';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='6';
      ParamByName('bobotRule').AsString:='0.7';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='6';
      ParamByName('bobotRule').AsString:='0.3';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.cekbox7;
begin
  if CheckBox7.Checked=True then
  begin
    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='A';
      ParamByName('bobot').AsString:='0.5';
      ParamByName('kdGejala').AsString:='7';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='B';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='7';
      ParamByName('bobotRule').AsString:='0.2';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='D';
      ParamByName('bobot').AsString:='0.6';
      ParamByName('kdGejala').AsString:='7';
      ParamByName('bobotRule').AsString:='0.9';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;

    with dm.quHitung do
    begin
      Close;
      sql.Clear;
      sql.Text := 'insert into tbhitung (kdPenyakit, bobot, kdGejala, bobotRule) VALUE '+
                '(:kdPenyakit, :bobot, :kdGejala, :bobotRule);';
      ParamByName('kdPenyakit').AsString:='F';
      ParamByName('bobot').AsString:='0.7';
      ParamByName('kdGejala').AsString:='7';
      ParamByName('bobotRule').AsString:='0.5';
      ExecSQL;
      SQL.Text := 'select * from tbhitung';
      Open;
    end;
  end;
end;

procedure TfoDiagnosa.FormClose(Sender: TObject; var Action: TCloseAction);
begin
//  gridbersih;
end;

procedure TfoDiagnosa.gridbersih;
begin
  dm.quHitung.Close;
  dm.quHitung.SQL.clear;
  dm.quHitung.SQL.TEXT:='delete from tbhitung';
  dm.quHitung.ExecSQL;

  dm.qukali.Close;
  dm.qukali.SQL.clear;
  dm.qukali.SQL.TEXT:='delete from tbkali';
  dm.qukali.ExecSQL;
end;

procedure TfoDiagnosa.kali;
begin
  with dm.quKali do
  begin
    SQL.Text:='insert into tbkali (kdPenyakit) value (:kdPenyakit)';
    ParamByName('kdPenyakit').AsString:='A';
    ExecSQL;
    SQL.Text:='select * from tbkali';
    Open;
  end;

  with dm.quKali do
  begin
    SQL.Text:='insert into tbkali (kdPenyakit) value (:kdPenyakit)';
    ParamByName('kdPenyakit').AsString:='B';
    ExecSQL;
    SQL.Text:='select * from tbkali';
    Open;
  end;

  with dm.quKali do
  begin
    SQL.Text:='insert into tbkali (kdPenyakit) value (:kdPenyakit)';
    ParamByName('kdPenyakit').AsString:='D';
    ExecSQL;
    SQL.Text:='select * from tbkali';
    Open;
  end;

  with dm.quKali do
  begin
    SQL.Text:='insert into tbkali (kdPenyakit) value (:kdPenyakit)';
    ParamByName('kdPenyakit').AsString:='F';
    ExecSQL;
    SQL.Text:='select * from tbkali';
    Open;
  end;
end;

end.
